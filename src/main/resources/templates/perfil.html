<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- T√≠tulo din√¢mico com nome do usu√°rio exibido -->
    <title th:text="'Perfil de ' + ${perfil.nome}">Perfil de Usu√°rio</title>
    
    <!-- Aplica o tema escuro salvo no localStorage antes de renderizar a p√°gina -->
    <script>
        (function() {
            if (localStorage.getItem('theme') === 'dark-mode') {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
    
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    
    <!-- Cabe√ßalho -->
    <div th:replace="~{fragments :: header}"></div>

    <main class="container-main">
        <div class="form-box profile-container">
            
            <!-- Cabe√ßalho do perfil (foto + nome + bio + bot√£o editar se for o pr√≥prio usu√°rio) -->
            <div class="profile-header">
                
                <div class="profile-header-info">
                    <div class="profile-pic-container">
                        <!-- Mostra foto de perfil, ou um placeholder se o usu√°rio n√£o tem foto -->
                        <img
                            th:if="${perfil.fotoPerfilUrl}"
                            th:src="@{/uploads/{filename}(filename=${perfil.fotoPerfilUrl})}"
                            alt="Foto de Perfil"
                            class="profile-pic"
                        >
                        <div
                            th:unless="${perfil.fotoPerfilUrl}"
                            class="profile-pic-placeholder"
                        ></div>
                    </div>

                    <div>
                        <!-- Nome do usu√°rio -->
                        <h2 class="main-title profile-name" th:text="${perfil.nome}"></h2>

                        <!-- Bio vis√≠vel s√≥ se existir conte√∫do -->
                        <p
                            th:if="${perfil.bio != null and !perfil.bio.isEmpty()}"
                            th:text="${perfil.bio}"
                            class="profile-bio"
                        ></p>
                    </div>
                </div>

                <!-- Bot√£o 'Editar Perfil' s√≥ aparece se o perfil exibido for do usu√°rio logado -->
                <div th:if="${session.usuarioLogado != null and session.usuarioLogado.id_usuario == perfil.id_usuario}">
                    <a th:href="@{/perfil/editar}" class="btn-edit">Editar Perfil</a>
                </div>
            </div>

            <hr class="section-divider">

            <!-- Se o visitante tem permiss√£o pra ver detalhes (perfil p√∫blico OU √© o dono),
                 mostra estat√≠sticas e eventos -->
            <div th:if="${podeVerDetalhes}">
                
                <!-- Se√ß√£o: m√©tricas esportivas do usu√°rio -->
                <div class="history-section">
                    <h3>M√©tricas de Desempenho</h3>

                    <!-- Mensagem caso o usu√°rio n√£o tenha registrado m√©tricas ainda -->
                    <div th:if="${metricas.isEmpty()}" class="no-events-message">
                        <p>Este usu√°rio ainda n√£o registrou nenhuma m√©trica.</p>
                    </div>

                    <!-- Lista de m√©tricas (ex.: gols, rebotes, etc.) -->
                    <div class="event-list" th:unless="${metricas.isEmpty()}">
                        <div th:each="metrica : ${metricas}" class="metric-card cursor-default">
                            <div class="card-header">
                                <h4>
                                    <span th:text="${metrica.esporte}"></span>
                                    -
                                    <span th:text="${#temporals.format(metrica.diaMetrica, 'dd/MM/yyyy')}"></span>
                                </h4>
                            </div>

                            <!-- Lista s√≥ mostra os campos que n√£o s√£o nulos -->
                            <ul class="metric-details-list">
                                <li th:if="${metrica.gols != null}">
                                    <strong>Gols:</strong>
                                    <span th:text="${metrica.gols}"></span>
                                </li>

                                <li th:if="${metrica.assistencias_futebol != null}">
                                    <strong>Assist√™ncias:</strong>
                                    <span th:text="${metrica.assistencias_futebol}"></span>
                                </li>

                                <li th:if="${metrica.desarmes != null}">
                                    <strong>Desarmes:</strong>
                                    <span th:text="${metrica.desarmes}"></span>
                                </li>

                                <li th:if="${metrica.pontos_basquete != null}">
                                    <strong>Pontos:</strong>
                                    <span th:text="${metrica.pontos_basquete}"></span>
                                </li>

                                <li th:if="${metrica.assistencias_basquete != null}">
                                    <strong>Assist√™ncias:</strong>
                                    <span th:text="${metrica.assistencias_basquete}"></span>
                                </li>

                                <li th:if="${metrica.rebotes != null}">
                                    <strong>Rebotes:</strong>
                                    <span th:text="${metrica.rebotes}"></span>
                                </li>

                                <li th:if="${metrica.pontos_volei != null}">
                                    <strong>Pontos:</strong>
                                    <span th:text="${metrica.pontos_volei}"></span>
                                </li>

                                <li th:if="${metrica.aces != null}">
                                    <strong>Aces:</strong>
                                    <span th:text="${metrica.aces}"></span>
                                </li>

                                <li th:if="${metrica.bloqueios != null}">
                                    <strong>Bloqueios:</strong>
                                    <span th:text="${metrica.bloqueios}"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <hr class="section-divider large-margin">

                <!-- Se√ß√£o: eventos criados por esse usu√°rio -->
                <div class="history-section">
                    <h3>Eventos Criados</h3>

                    <div th:if="${eventosCriados == null or eventosCriados.isEmpty()}" class="no-events-message">
                        <p th:text="${perfil.nome} + ' ainda n√£o criou nenhum evento.'"></p>
                    </div>

                    <!-- Lista de eventos criados pelo usu√°rio.
                         Cada card √© clic√°vel e manda para a p√°gina do evento -->
                    <div class="event-list" th:unless="${eventosCriados == null or eventosCriados.isEmpty()}">
                        <div
                            th:each="evento : ${eventosCriados}"
                            class="event-card cursor-pointer"
                            th:onclick="'window.location.href=\'' + @{/evento/{id}(id=${evento.id_evento})} + '\''"
                        >
                            <h4>
                                <a
                                    th:href="@{/evento/{id}(id=${evento.id_evento})}"
                                    th:text="${evento.modalidadeEvento}"
                                ></a>
                            </h4>

                            <p th:text="'Em ' + ${#temporals.format(evento.dataHoraEvento, 'dd/MM/yyyy')}"></p>
                        </div>
                    </div>
                </div>

                <hr class="section-divider large-margin">

                <!-- Se√ß√£o: eventos onde o usu√°rio est√° inscrito como participante -->
                <div class="history-section">
                    <h3>Eventos Inscritos</h3>

                    <div th:if="${eventosInscritos == null or eventosInscritos.isEmpty()}" class="no-events-message">
                        <p th:text="${perfil.nome} + ' n√£o est√° inscrito(a) em nenhum evento.'"></p>
                    </div>

                    <!-- Lista de eventos em que ele √© participante -->
                    <div class="event-list" th:unless="${eventosInscritos == null or eventosInscritos.isEmpty()}">
                        <div
                            th:each="evento : ${eventosInscritos}"
                            class="event-card cursor-pointer"
                            th:onclick="'window.location.href=\'' + @{/evento/{id}(id=${evento.id_evento})} + '\''"
                        >
                            <h4>
                                <a
                                    th:href="@{/evento/{id}(id=${evento.id_evento})}"
                                    th:text="${evento.modalidadeEvento}"
                                ></a>
                            </h4>

                            <p th:text="'Em ' + ${#temporals.format(evento.dataHoraEvento, 'dd/MM/yyyy')}"></p>

                            <p>
                                Criado por:
                                <a
                                    th:href="@{/perfil/{id}(id=${evento.usuarioCriador.id_usuario})}"
                                    th:text="${evento.usuarioCriador.nome}"
                                ></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Caso o perfil seja privado e o visitante n√£o tenha permiss√£o -->
            <div th:unless="${podeVerDetalhes}" class="no-events-message text-center">
                <p class="private-profile-title">üîí Este perfil √© privado.</p>
                <p>As m√©tricas e atividades do usu√°rio n√£o est√£o vis√≠veis para o p√∫blico.</p>
            </div>
            
        </div> 
    </main>
    
    <script th:src="@{/js/theme.js}"></script>
</body>
</html>
